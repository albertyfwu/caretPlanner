<html>
	<head>
		<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
		
		<script src="js/jquery-ui-timepicker-addon.js" type="text/javascript"></script>
		<link href="style/style.css" rel="stylesheet" type="text/css">
		<script>
		$(document).ready(function() {
			$("#content").tabs();
			$(".dateTimePicker").datetimepicker({
				ampm: true
			});
// 			alert('hello');
		});
		</script>
	</head>
	<body>
		<div id="wrap">
			<div id="header-wrap">
				<div id="header">
					<a href="/"><img src="img/logo.png" /></a>
					<!-- span id="title"><span id="social">social</span><span id="planner">Planner</span></span>-->
					<button id="signOut">Sign Out</button>
				</div>
			</div>
			
			<div id="inner-wrap">
				<div id="content">
					<ul>
						<li><a href="#tabs-0">Calendar</a></li>
						<li><a href="#tabs-1">Find Events between Friends</a></li>
						<li><a href="#tabs-2">Schedule an Event</a></li>
						<li><a href="#tabs-3">Find friends at an event</a>
					</ul>
					<div id="tabs-0">
						<iframe src="https://www.google.com/calendar/embed?wkst=1&amp;bgcolor=%23FFFFFF&amp;src={{ username }}%40gmail.com&amp;color=%23A32929&amp"
						style="border-width:0" width="100%" height="90%" frameborder="0" scrolling="no"></iframe>
					</div>
					<div id="tabs-1">
						First, select the friends on the left you'd like to find common events with. Then, let us know the time range you'd like to look in.
						<br />
						Start: <input type="text"  value="" class="dateTimePicker" id="eventsStartTime" />
						End: <input type="text" value="" class="dateTimePicker" id="eventsEndtime" />
						<br />
						<input type="submit" id="findEventsButton" value="Go" />
						<div id="findEventsOutsideDiv">
							<div id='findEventsLoader' style='display:none'>
								<img src='img/loader.gif' />
							</div>
							<div id="findEventsResultsDiv">
							<font size ="14">
								<!-- initially empty -->
								<table>
									<tr>
										<td>Test</td><td>Test2</td><td>Test3</td>
									</tr>
								</table>
							</font>
							</div>
						</div>
					</div>
					<div id="tabs-2">
						First, select the friends on the left you'd like to find good times with. Then, let us know the time range you'd like to look in (currently defaulted to between 1pm and 5pm).
						<br />
						Start: <input type="text"  value="" class="dateTimePicker" id="timesStartDate" />
						End: <input type="text" value="" class="dateTimePicker" id="timesEndDate" />
						<br />
						<input type="submit" id="findTimesButton" value="Go" />
						<div id="findTimesResultsDiv">
							Results:
							<table width="100%">
								<thead>
									<tr>
										<td>Event Name</td>
										<td>Start Time</td>
										<td>End Time</td>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>asdf</td>
										<td>asdf</td>
										<td>asdf</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div id="tabs-3">
						Give us a time range and an event query, and you'll be on your way.
						<br />
						Start: <input type="text"  value="" class="dateTimePicker" id="eventsSearchStartTime" />
						End: <input type="text" value="" class="dateTimePicker" id="eventsSearchEndTime" />
						<br />
						Event: <input type="text" id="findEventsSearchTextQuery" />
						<input type="submit" id="findEventsSearchButton" value="Go" />
						<div id="findEventsSearchOutsideDiv">
							<div id='findEventsSearchLoader' style='display:none'>
								<img src='img/loader.gif' />
							</div>
							<div id="findEventsSearchResultsDiv">
								<!-- initially empty -->
							</div>
						</div>
					</div>
				</div>
				
				<div id="sidebar">
					<div id="contactsTitleDiv">
						<span id="contactsTitle">Contacts</span>
					</div>
										
					<div id="contacts">
						{% for contact in contacts %}
							<input class="contact" type="checkbox" value="{{ contact.email }}">{{ contact.name }}<br />
						{% endfor %}
					</div>
<!-- 					<div id="circleButtons"> -->
<!-- 						<button id="compareButton">Compare</button> -->
<!-- 						<button id="scheduleButton">Schedule</button> -->
<!-- 					</div> -->

				</div>
			</div>
			
			<div id="footer-wrap">			
				<div id="footer">
					<span id="copyright">Copyright socialPlanner 2012</span> | 
					<a href="/about">About Us</a>
				</div>
			</div>
		</div>
		<div id="popupContact">
			<a id="popupContactClose" href="#">x</a>
			<h1>Title of popup</h1>
			<p id="contactArea">
				blahblah<br />
				<input type="text" value="" id="query" /><br />
				<span id="seethis"></span><br />
				Click on X in the top-right corner to close.
			</p>
		</div>
		<div id="backgroundPopup"></div>
		<script>
			//0 means disabled; 1 means enabled;
			$("#query").keyup(function() {
				$.post('/', {query: $("#query").val()}, function(data) {
					result = 'Matches:<br /><br />';
					$.each(data.matches, function(i, match) {
						result += match + '<br />';
					});
					$("#seethis").html(result);
				});
			});
			
			$(document).keydown(function(e) {
				if (e.keyCode == 27) {
					disablePopup();
				}
			});
			
			var popupStatus = 0;
			
			function loadPopup(){
				if (popupStatus == 0) {
					$("#backgroundPopup").css({
						"opacity": "0.7"
					});
					$("#backgroundPopup").fadeIn("slow");
					$("#popupContact").fadeIn("slow");
					popupStatus = 1;
				}
			}
			
			function disablePopup(){
				if(popupStatus==1) {
					$("#backgroundPopup").fadeOut("slow");
					$("#popupContact").fadeOut("slow");
					popupStatus = 0;
				}
			}
			
			function centerPopup(){
				var popupHeight = $("#popupContact").height();  
				var popupWidth = $("#popupContact").width(); 
// 				centering
				$("#popupContact").css({
					"position": "absolute",
					"top": $(window).height()/2-popupHeight/2,
					"left": $(window).width()/2-popupWidth/2	
				});
			}
			
			$("#compareButton").click(function() {
// 				centerPopup();
// 				loadPopup();
				$("#content").tabs().tabs('select', '#tabs-1');
			});
			
			$("#popupContactClose").click(function() {
				disablePopup();
			});
			
			$("#backgroundPopup").click(function() {
				disablePopup();
			});
		
			$("#signOut").click(function() {
				$.post('/signOut');
				window.location.href = "{{signOutUrl}}";
			});
			
			$("#scheduleButton").click(function() {
				var contacts = new Array();
				var i = 0;
				$("input:checked").each(function(index, value) {
					contacts[index] = value.value;
				});
				$.post('/scheduleEvent', {contacts: JSON.stringify(contacts)}, function(data) {
					$("#content").tabs().tabs('select', '#tabs-2');
					$("#tabs-2").html(data);
				});
			});
			
			$("#findEventsButton").click(function() {
				// make sure to do a check for valid start and end times
				var startTime = $("#eventsStartTime").val();
				var endTime = $("#eventsEndtime").val();
				var friends = [];
				$(".contact:checked").each(function() {
					friends.push($(this).val());
				});
				var query = {startTime: startTime,
							 endTime: endTime,
							 friends: friends};
				if (friends.length == 0) {
					alert("Please select at least one friend.")
				}
				else {
					// let user know that we are loading
					$("#findEventsResultsDiv").html('');
					$("#findEventsLoader").show();
					
					$.post('/findCommonEvents', {jsonData: JSON.stringify(query)}, function(data) {
						var html = "Results:<table border=1 width='100%'>";
						html += '<thead><tr><td>Name</td><td>Start</td><td>End</td></tr></thead><tbody>';
						for(var i = 0; i < data.length; i++) {
							var event = data[i];
							html += '<tr>';
							html += '<td>' + event.name + '</td>';
							html += '<td>' + event.startTime + '</td>';
							html += '<td>' + event.endTime + '</td>';
							html += '</tr>';
						}
						
						html += '</tbody></table>';
						$("#findEventsLoader").hide();
						$("#findEventsResultsDiv").html(html);
					});
				}
			});	
			
			$("#findTimesButton").click(function() {
				var startDate = $("#timesStartDate").val();
				var endDate = $("#timesEndDate").val();
				var friends = [];
				$(".contact:checked").each(function() {
					friends.push($(this).val());
				});
				var query = {startDate: startDate,
							 endDate: endDate,
							 friends: friends}
				// post the jQuery to the backend for results
				
				$.post('/findCommonTimes', {jsonData: JSON.stringify(query)}, function(data) {
					var html = 'Results:<table>';
					$(data).each(function() {
						html += '<tr>';
						html += '<td>' + data.name + '</td>';
						html += '<td>' + data.startTime + '</td>';
						html += '<td>' + data.endTime + '</td>';
						html += '</tr>';
					});
					html += '</table>'
					$("#findTimesResultsDiv").html(html);
				});
			});
			
			$("#findEventsSearchButton").click(function() {
				// make sure to do a check for valid start and end times
				var startTime = $("#eventsSearchStartTime").val();
				var endTime = $("#eventsSearchEndTime").val();
				var eventQuery = $("#findEventsSearchTextQuery").val();
				var friends = [];
				$(".contact:checked").each(function() {
					friends.push($(this).val());
				});
				var query = {startTime: startTime,
							 endTime: endTime,
							 eventQuery: eventQuery,
							 friends: friends};
				
				// let user know that we are loading
				$("#findEventsResultsDiv").html('');
				$("#findEventsLoader").show();
				alert("before post");
				$.post('/findEvents', {jsonData: JSON.stringify(query)}, function(data) {
					alert("post successful");
// 					var html = "Results:<table border=1 width='100%'>";
// 					html += '<thead><tr><td>Name</td><td>Start</td><td>End</td></tr></thead><tbody>';
					
// 					for(var i = 0; i < data.length; i++) {
// 						var event = data[i];
// 						html += '<tr>';
// 						html += '<td>' + event.name + '</td>';
// 						html += '<td>' + event.startTime + '</td>';
// 						html += '<td>' + event.endTime + '</td>';
// 						html += '</tr>';
// 					}
					
// 					html += '</tbody></table>';
// 					$("#findEventsLoader").hide();
// 					$("#findEventsResultsDiv").html(html);
				});
			});
		</script>
	</body>
</html>